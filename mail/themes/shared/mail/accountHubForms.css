/* This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/. */

@namespace xul "http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul";

form {
  --hub-input-bg-color: light-dark(var(--color-neutral-base), #18181b);
  --hub-select-color: light-dark(var(--color-text-base), currentColor);
  --hub-menulist-color: var(--color-text-base);
  --hub-menulist-background-color: var(--color-neutral-subtle);
  --hub-menulist-background-color-hover-focus-open: var(--color-neutral-base);
  --hub-menulist-border-color: var(--color-neutral-border);
  --hub-menulist-border-color-hover-focus: var(--color-primary-pressed);
  --hub-menulist-border-color-open: var(--color-primary-default);
  --hub-menulist-outline-color-focus: var(--color-primary-default);
  --hub-menulist-label-color: var(--color-text-base);
  --hub-menupopup-border-color: var(--color-neutral-border);
  --hub-menuitem-color-selected: var(--color-neutral-base);
  --hub-menuitem-background-color-selected: var(--color-primary-default);
  /* TODO: apply dark mode styling */

  grid-row: header / footer;

  .hub-body {
    align-items: stretch;
    justify-content: flex-start;
    place-self: center;
    gap: 40px;
    width: 100%;
    max-width: 400px;
    text-align: start;
    margin-inline: 0;
  }

  .hub-body.flex-direction-row {
    max-width: 700px;
  }

  input[type="checkbox"] {
    box-sizing: border-box;
    width: 16px;
    height: 16px;
    border: 1px solid var(--color-neutral-border-intense);
    border-radius: 4px;
    appearance: none;
    background-color: var(--color-neutral-lower);

    &:disabled {
      border: 1px solid var(--color-neutral-border);
      background-color: var(--color-neutral-subtle);

      &+.checkbox-label {
        color: var(--color-text-muted);
      }
    }
  }

  input[type="checkbox"]:checked:enabled {
    background-color: var(--color-primary-default);
    border-color: var(--color-primary-hover);
    -moz-context-properties: fill;
    fill: var(--color-neutral-base);
    content: url("chrome://messenger/skin/overrides/check.svg");
  }

  .checkbox-label {
    color: var(--color-text-base);
  }

  label {
    font-size: 1.2rem;
    line-height: 1;
    color: light-dark(var(--color-primary-hover), #feffff);

    &.animated {
      position: absolute;
      background-color: var(--hub-input-bg-color);
      border-radius: 3px;
      transform-origin: left center;
      color: var(--color-text-secondary);
      padding: 3px;
      margin-inline-start: 7px;
      font-weight: 200;
      cursor: text;

      @media (prefers-reduced-motion: no-preference) {
        transition: transform 200ms, color 200ms, font-weight 200ms, background-color 200ms;
      }
    }

    .selected-option {
      padding-block: 13px;
      padding-inline: 10px;
      background: var(--color-neutral-subtle);
      border: 1px solid var(--color-neutral-border);
      margin-block-start: 5px;
      border-radius: 2px;
      color: var(--hub-select-color);
    }
  }

  .input-field {
    flex: 1;
    font-size: 1.2rem;
    margin-inline: 0;
    padding-block: 12px;
    padding-inline: 9px 14px;
    border: 1px solid var(--color-neutral-border);
    background-color: var(--hub-input-bg-color);
    font-weight: 200;

    &:user-invalid {
      border-color: light-dark(var(--color-danger-default), var(--color-danger-pressed));
      outline: 1px solid light-dark(var(--color-danger-default), var(--color-danger-pressed));
      outline-offset: 0;

      &:focus {
        border-color: light-dark(var(--color-danger-default), var(--color-danger-pressed));
      }

      & ~ label {
        color: light-dark(var(--color-danger-default), var(--color-danger-pressed));
      }
    }

    &::placeholder {
      font-weight: 200;
      color: var(--color-text-secondary);
    }

    &.animated {
      &::placeholder {
        color: transparent;
      }
    }

    &:focus {
      border-color: light-dark(var(--color-primary-hover), var(--color-primary-default));
    }

    &:focus-visible {
      outline: none;
    }

    &:focus + label.animated,
    &:not(:placeholder-shown) + label.animated {
      transform: translateY(-102%);
      font-weight: normal;
      cursor: default;
      background-color: var(--color-neutral-base);
    }

    &.number-input {
      padding-inline-end: 0;
      border-radius: 4px;
      border-width: 1px;

      &::-moz-number-spin-box {
        height: 100%;
        width: 22px;
        border-inline-start: 1px solid var(--color-neutral-border);
        border-inline-end: 0;
        background: var(--color-neutral-subtle);
        align-items: center;
        cursor: pointer;
      }

      &::-moz-number-spin-up,
      &::-moz-number-spin-down {
        height: 8px;
        appearance: none;
        padding: 5px 2px;
        -moz-context-properties: stroke;
        stroke: currentColor;
        cursor: pointer;
      }

      &::-moz-number-spin-up {
        border-block-end: 1px solid var(--color-neutral-border);
        content: var(--icon-nav-up-sm);
      }

      &::-moz-number-spin-down {
        content: var(--icon-nav-down-sm);
      }
    }
  }

  .menulist {
    margin-inline: 0px;
    padding-inline-start: 6px;
    padding-block: 12px;
    line-height: 1.5;
    border: 1px solid var(--hub-menulist-border-color);
    border-radius: var(--hub-input-border-radius);
    background-color: var(--hub-menulist-background-color);

    &:hover,
    &[open="true"]:not([disabled="true"]) {
      border-color: var(--hub-menulist-border-color-hover-focus);
      background-color: var(--hub-menulist-background-color-hover-focus-open);
    }

    &[open="true"]:not([disabled="true"]) {
      border-color: var(--hub-menulist-border-color-open);
    }

    &:focus-visible {
      outline: 2px solid var(--hub-menulist-outline-color-focus);
      outline-offset: var(--focus-outline-offset);
    }
  }

  xul|menupopup.menupopup {
    --arrowpanel-padding: 4px 0;
    --panel-background: var(--arrowpanel-background);
    --panel-color: var(--arrowpanel-color);
    --panel-border-color: var(--hub-menupopup-border-color);
    --panel-border-radius: var(--arrowpanel-border-radius);
    --panel-padding: var(--arrowpanel-padding);
    --menu-color: var(--arrowpanel-color);
    --menu-border-color: var(--arrowpanel-border-color);
    --menu-background-color: var(--arrowpanel-background);
    margin-block-start: 6px;

    & > xul|menuitem {
      padding: var(--menu-item-padding);
      padding-inline: 6px;

      & label {
        color: var(--color-text-base);
        font-weight: 400;
      }

      &:is([checked="true"], [selected="true"]) {
        background-color: var(--hub-menuitem-background-color-selected);

        & label {
          color: var(--hub-menuitem-color-selected);
          font-weight: 400;
        }
      }
   }
  }

  legend {
    margin-block: 0 10px;
    background-color: var(--hub-account-primary-button-background);
    border-radius: 7px;
    padding: 5px 10px;
    font-size: 0.9rem;
    text-transform: uppercase;
    color: var(--hub-button-color);
  }
}

div:has(legend) {
  display: flex;
}

.input-control {
  display: flex;
  align-items: center;
}

.input-control.vertical {
  flex-direction: column;
  align-items: stretch;
}

.form-icon {
  width: 16px;
  height: 16px;
  margin-inline: -26px 10px;

  input:user-invalid ~ & {
    display: none;
  }

  input:valid ~ & {
    display: none;
  }
}

.notification-bar {
  padding: 4px 12px;
  margin: 16px 75px 5px;
  text-align: start;
  border: 1px solid;
  border-radius: 3px;

  &[aria-disabled="true"] {
    pointer-events: none;
  }

  &[open=""] #emailFormNotificationToggle {
    span:first-of-type {
      display: none;
    }

    span:last-of-type {
      display: flex
    }
  }

  #emailFormNotificationToggle {
    span:first-of-type {
      display: flex;
    }

    span:last-of-type {
      display: none;
    }
  }

  .notification-icon {
    margin-inline: 0 10px;
    display: none;
  }

  .notification-title-container {
    display: flex;
    align-items: center;
    cursor: pointer;

    span {
      font-size: 1.1rem;
      padding-inline-start: 5px;
      text-decoration: underline;
      margin-inline-start: auto;
      white-space: nowrap;
    }
  }

  .notification-title {
    font-size: 1.1rem;
    font-weight: 700;
    margin-block: 4px;
    width: 100%;
    text-align: center;
  }

  .notification-text {
    margin-block: 6px;
    font-size: 1rem;
  }

  .form-icon {
    cursor: pointer;
  }

  &.error {
    background-color: var(--color-danger-soft);
    color: var(--color-danger-pressed);
    border-color: var(--color-danger-default);

    .icon-danger {
      display: inline-block;
    }
  }

  &.warning {
    background-color: var(--color-warning-soft);
    color: var(--color-text-warning);
    border-color: var(--color-warning-default);

    .icon-warning {
      display: inline-block;
    }
  }

  &.success {
    background-color: var(--color-success-soft);
    color: var(--color-success-pressed);
    border-color: var(--color-success-default);

    .icon-success {
      display: inline-block;
    }
  }

  &.info {
    background-color: var(--color-primary-soft);
    color: var(--color-primary-pressed);
    border-color: var(--color-primary-default);

    .icon-info {
      display: inline-block;
    }
  }
}

.form-toggle-button {
  cursor: pointer;
  appearance: none;
  background: transparent;
  border: none;
  padding: 0 4px;
  margin-inline: -30px 6px;
  min-width: auto;
  min-height: auto;
  margin-block: 0;
  line-height: 0;
}

.form-toggle-button:hover,
.form-toggle-button:active {
  background-color: transparent !important;
}

.form-toggle-button .form-icon {
  pointer-events: none;
  margin-inline: 0;
}

#password:placeholder-shown + .form-toggle-button {
  display: none;
}

#password[type="password"] + .form-toggle-button .form-icon {
  content: var(--icon-hidden);
}

#password[type="text"] + .form-toggle-button .form-icon {
  content: var(--icon-eye);
}

#password[type="text"] + .form-toggle-button {
  color: var(--in-content-primary-button-background);
  fill: color-mix(in srgb, currentColor 20%, transparent);
  stroke: currentColor;
}

.input-warning {
  display: none;
  input:user-invalid ~ & {
    display: inline-block;
  }
}

.input-success {
  input:invalid ~ & {
    display: none;
  }

  input:user-valid ~ & {
    display: inline-block;
  }
}

.config-form-data {
  display: grid;
  grid-template-columns: 2fr 60%;
  column-gap: 20px;

  & .selection-grid {
    display: grid;
    grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
    grid-template-rows: auto;
    gap: 12px;
    padding-inline: 12px;

    & .config-column {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
  }

  & .form-options {
    display: flex;
    flex-direction: column;
    justify-content: stretch;
    margin: 0;
    padding: 0;
    border: 0;
    gap: 10px;
  }

  & .config-option {
    background-color: light-dark(rgba(254, 255, 255, 0.5), rgba(26, 32, 44, 0.5));
    display: flex;
    flex-direction: column;
    border-radius: 10px;
    cursor: pointer;
    overflow: hidden;
    font-size: 1.2rem;
    line-height: normal;
    border: 1px solid transparent;

    & .recommended {
      display: none;
      text-transform: uppercase;
      font-size: 0.9rem;
      font-weight: 600;
      margin-inline-start: auto;
      padding: 2px;
      border: 1px solid transparent;
      border-radius: 3px;
    }

    &.recommended-protocol .recommended {
      display: flex;
    }

    & .config-title {
      color: light-dark( var(--color-primary-default), #feffff);
      display: flex;
      align-items: center;
      padding-block: 8px 2px;
      padding-inline: 8px;
      font-weight: bold;

      & input[type="radio"] {
        appearance: none;
        background-color: transparent;
        margin-inline-end: 8px;
        width: 15px;
        height: 15px;
        border: 1px solid var(--color-neutral-border-intense);
        border-radius: 50%;
        display: grid;
        place-content: center;

        &::before {
          content: "";
          width: 5px;
          height: 5px;
          border-radius: 50%;
          transform: scale(0);
          box-shadow: inset 1em 1em var(--color-neutral-base);
        }

        &:checked::before {
          transform: scale(1);
        }
      }
    }

    & .config-text {
      color: var(--color-text-base);
      font-weight: 400;
      padding-block: 2px 6px;
      padding-inline: 9px;
      font-size: 1.1rem;
    }


    &.selected {
      border-color: var(--color-primary-default);

      & .config-title {
        background-color: var(--color-primary-default);
        color: var(--color-neutral-base);
        padding-block: 6px;
      }

      & .config-text {
        color: light-dark(#15427c, var(--color-text-base));
        background-color: var(--color-neutral-base);
        padding-block: 6px;
      }

      & .recommended {
        background-color: light-dark(var(--color-primary-soft), transparent);
        color: light-dark(var(--color-primary-default), currentColor);
      }

      & input[type="radio"]:checked {
        border-width: 2px;
        border-color: var(--color-neutral-base);
      }
    }
  }

  & .form-selection {
    display: flex;
    flex-direction: column;
    gap: 12px;
    background-color: var(--color-neutral-base);
    padding: 6px;
    border: 1px solid var(--color-primary-default);
    border-radius: 10px;

    &.single .selection-grid {
      grid-template-columns: auto;
    }

    & .config-item-icon {
      height: 20px;
      width: 20px;
      -moz-context-properties: fill, stroke, stroke-opacity;
      fill: light-dark(color-mix(in srgb, #bdbdbd 20%, transparent), color-mix(in srgb, #3d4d67 20%, transparent));
      stroke: light-dark(#bdbdbd, #3d4d67);

      &.lighter {
        fill: light-dark(color-mix(in srgb, #bdbdbd 5%, transparent), color-mix(in srgb, #3d4d67 5%, transparent));
      }
    }

    & .config-directions {
      background-color: light-dark(#f0f8ff, #262c40);
      padding-block: 10px;
      border-radius: 6px;

      & .config-detail {
        padding-block: 0;

        & img {
          height: 30px;
          width: 30px;
        }

        & .config-item-data {
          p {
            &:first-of-type {
              color: light-dark(#2176d6, #feffff);
              font-weight: 500;
              font-size: 1.3rem;
            }

            &:last-of-type {
              font-size: 1rem;
              color: var(--color-text-secondary);
            }
          }
        }
      }
    }

    & .config-detail {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 9px;

      & .config-item-data {
        overflow: hidden;
        display: flex;
        flex-direction: column;
        gap: 2px;

        & p {
          overflow: hidden;
          text-overflow: ellipsis;
          line-height: normal;
          margin: 0;

          &:first-of-type {
            font-size: 0.8rem;
            text-transform: uppercase;
            color: var(--color-text-secondary);
            font-weight: 500;
          }

          &:last-of-type {
            color: var(--color-text-base);
            font-weight: 400;
          }
        }
      }
    }
  }
}

.custom-action-container {
  grid-column: 1 / -1;
  text-align: end;
}

.align-self-end {
  align-self: end;
}

.remember-button-container {
  margin-block-start: -18px;
}

#accountHubFooterMenu {
  background-color: transparent;
}
